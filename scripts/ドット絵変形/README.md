# ドット絵変形.anm2

ドット絵の拡大縮小・回転を行うスクリプト。

標準描画と違い、これはドット絵でもドットのまま変形されます。
また、発展補間オプションを有効にすると線がより綺麗に補間されます。
（発展補間はまだ実験的機能です！バージョンの更新により動作が変わる可能性があります。）

## ピクセル補正について

ドット絵を変形するとき、変形後の画像の位置がピクセルグリッドに乗らずにぼやけてしまうことがあります。
（シーンの左上から見た画像の左上の位置が(1.3, 2.7)のように小数点になる場合）
ピクセル補正を有効にすると、変形後の画像がピクセルグリッドに乗るように調整され、ぼやけを防止します。

> [!TIP]
> sigma-axis氏のaviutl2_script_PixelSnap_Sも同様の動作を行います： <https://github.com/sigma-axis/aviutl2_script_PixelSnap_S>

### モード

- 中心移動式：画像の左上がピクセルグリッドに乗るように中心点が調整されます。
- 描画移動式：画像の左上がピクセルグリッドに乗るように描画位置が調整されます。
- サンプラー式：AviUtl2のピクセル補間モードを変更します。
  このエフェクトの後にエフェクトを追加するとピクセル補正が無効になるかもしれません。
- オフ：ピクセル補正を行いません。

## 発展補間について

有効にすると、ドット絵の線が塗りの上に描画されるように補間され、線が消えにくくなります。
また、拡大時に斜めの線がより綺麗に補間されます。
この機能はcleanEdgeをベースにしています。cleanEdgeについてはこのページを参照してください： <https://torcado.com/cleanEdge/>

### パラメーター

- 基準色：線の上書き判定に使う色。例えば#ffffffの場合は明るい色が優先されます。もしドット絵に外枠がある場合は、外枠を設定すると綺麗になります。
  cleanEdgeのHighest Colorに相当します。
- 線の太さ：線の太さを指定します。ピクセルが何マス分に広がるかを指定します。45度の線を綺麗にしたい場合は0.707付近にしてください。
  cleanEdgeのLine Widthに相当します。
- 斜め補間：拡大時に補間する傾斜を指定します。
  - 1:1：45度の線のみ補間します。
  - 1:1 + 1:2：45度と26.565度（1:2の傾き）の線を補間します。
  - 1:1 + 1:2（補正）：45度と26.565度（1:2の傾き）の線を補間し、さらに1:2の線をより綺麗に補間します。
    cleanEdgeのSlopesに相当します。
- 補間閾値：斜め補間をするときに、どのくらい似ている色を同じ色として扱うかを指定します。
  高めると似ている色の間が滑らかに補間されるようになりますが、高すぎると乱れが発生します。
  可能な限り低く設定することをお勧めします。
  cleanEdgeのSimilar Thresholdに相当します。

## PI

- `scale_x`：X拡大率（1.0で等倍）
- `scale_y`：Y拡大率（1.0で等倍）
- `center_x`：中心X（ピクセル単位）
- `center_y`：中心Y（ピクセル単位）
- `angle_deg`：回転（度）
- `enable_cleanedge`：発展補間
- `highest_color`：基準色
- `line_width`：線の太さ
- `slopes`：斜め補間（0 = 「1:1のみ」、1 = 「1:1 + 1:2」、2 = 「1:1 + 1:2（補正）」）
- `similar_threshold`：補間閾値
- `alpha_grid`：透明グリッド
- `pixelsnap`：ピクセル補正（1 = 中心移動式、2 = 描画移動式、3 = サンプラー式、0 = オフ）
- `debug`：デバッグモード

# 更新履歴

## v3.1（2025/12/13） <!-- commit-override: a2445e8 -->

- ピクセルスナップを追加

## v3.0（2025/12/12） <!-- commit-override: 5fcc2a7 -->

- cleanEdgeベースの発展補間オプションを追加

## v2.1（2025/12/11） <!-- commit-override: d31c227 -->

- 回転時にピクセルがガタつく問題を修正

## v2.0（2025/12/10） <!-- commit-override: 4f848b5 -->

- アルゴリズムを完全に書き直し、回転でもドットが維持されるように改善

## v1.0（2025/12/4） <!-- commit-override: 4a8d9bb -->

- 初版リリース
